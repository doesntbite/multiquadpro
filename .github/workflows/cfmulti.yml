name: Deploy 10 Workers with Custom Domains

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ§± Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ðŸ“¦ Install Wrangler
        run: npm install -g wrangler

      - name: ðŸš€ Deploy Workers with Custom Domains
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          cp wrangler.toml wrangler.toml.bak

          for i in {1..2}; do
            name="siren$i"
            domain="zxc$i.sumbangsih.dpdns.org"

            echo "ðŸŒ Deploying $name â†’ $domain"

            cp wrangler.toml.bak wrangler.temp.toml

            # Ganti nama Worker
            sed -i "s/^name = \".*\"/name = \"$name\"/" wrangler.temp.toml

            # Tambahkan routes dengan custom domain
            echo -e "\nroutes = [\n  { pattern = \"$domain\", custom_domain = true }\n]" >> wrangler.temp.toml

            # Deploy Worker
            wrangler deploy --config wrangler.temp.toml

            echo "âœ… Finished $name"
          done

          rm -f wrangler.temp.toml
